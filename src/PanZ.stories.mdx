import { Meta, Story, Preview, Props } from '@storybook/addon-docs/blocks';
import { action } from '@storybook/addon-actions';
import {
  Example,
  Box,
  Viewport,
  LargeContainer,
  LargeContainerWithCenter,
  randomElement,
  useRandomIndex,
} from './docs';

import PanZ from './PanZ';

<Meta title="Examples" />

> __NOTE__ The following examples use React for demonstration purposes
> but PanZ is not dependent on React.

### With boundingElement
This example shows how you can use the `boundingElement` option to specify
the element that provides the clamping bounds.

<Preview>
  <Story name="Full Width Example">
    <Example>{ () => {
      const [pz] = React.useState(() => new PanZ());
      const elementRef = React.useRef();
      const boundingRef = React.useRef();
      //
      React.useEffect(() => {
        if (elementRef.current && boundingRef.current) {
          pz.init(elementRef.current, {boundingElement: boundingRef.current});
          return () => pz.destroy();
        }
      }, []);
      //
      return (
        <LargeContainer ref={boundingRef}>
          <Box ref={elementRef} />
        </LargeContainer>
      );
    }}</Example>
  </Story>
</Preview>

### Unbounded & Reset
This example shows an unbounded pan zoom element with a button
to reset the element to its original position and scale.

<Preview>
  <Story name="Reset Example">
    <Example>{ () => {
      const [pz] = React.useState(() => new PanZ({bounds: false}));
      const elementRef = React.useRef();
      const boundingRef = React.useRef();
      //
      React.useEffect(() => {
        if (elementRef.current && boundingRef.current) {
          pz.init(elementRef.current, {boundingElement: boundingRef.current});
          return () => pz.destroy();
        }
      }, []);
      //
      return (
        <>
          <LargeContainer ref={boundingRef}>
            <Box ref={elementRef} />
          </LargeContainer>
          <button onClick={() => pz.reset()}>Reset</button>
        </>
      );
    }}</Example>
  </Story>
</Preview>

### Center
This example shows how to center the element position within the `boundingClient`.

<Preview>
  <Story name="Center Example">
    <Example>{ () => {
      const [pz] = React.useState(() => new PanZ());
      const elementRef = React.useRef();
      const boundingRef = React.useRef();
      //
      React.useEffect(() => {
        if (elementRef.current && boundingRef.current) {
          pz.init(elementRef.current, {boundingElement: boundingRef.current});
          return () => pz.destroy();
        }
      }, []);
      //
      return (
        <>
          <LargeContainer ref={boundingRef}>
            <Box ref={elementRef} />
          </LargeContainer>
          <button onClick={() => pz.center()}>Center</button>
        </>
      );
    }}</Example>
  </Story>
</Preview>

### Contain & Cover
This example shows how to contain (or cover) the element inside the `boudingClient` similar
to the [CSS object-fit](https://developer.mozilla.org/en-US/docs/Web/CSS/object-fit).

<Preview>
  <Story name="Contain Example">
    <Example>{ () => {
      const [pz] = React.useState(() => new PanZ());
      const elementRef = React.useRef();
      const boundingRef = React.useRef();
      //
      React.useEffect(() => {
        if (elementRef.current && boundingRef.current) {
          pz.init(elementRef.current, {boundingElement: boundingRef.current});
          return () => pz.destroy();
        }
      }, []);
      //
      return (
        <>
          <LargeContainer ref={boundingRef}>
            <Box ref={elementRef} />
          </LargeContainer>
          <button onClick={() => pz.contain()}>Contain</button>
          <button onClick={() => pz.cover()}>Cover</button>
        </>
      );
    }}</Example>
  </Story>
</Preview>


### Center On
This example shows how pan and zoom at the same time using the `centerOn` method.

<Preview>
  <Story name="Center On Example">
    <Example>{ () => {
      const [pz] = React.useState(() => new PanZ());
      const [loc, setLoc] = React.useState({x: 0.5, y: 0.5, z: 1});
      const elementRef = React.useRef();
      const boundingRef = React.useRef();
      //
      const scales = [0.5, 1, 2, 2.5, 3.2, 4];
      const randomize = useRandomIndex(scales);
      const randomPoint = React.useCallback(() => {
        if (elementRef.current) {
          const x = Math.random();
          const y = Math.random();
          const z = scales[randomize()];
          setLoc({x, y, z});
          pz.centerOn(x, y, z);
        }
      });
      //
      React.useEffect(() => {
        if (elementRef.current && boundingRef.current) {
          pz.init(elementRef.current, {boundingElement: boundingRef.current, initialFit: 'center'});
          return () => pz.destroy();
        }
      }, []);
      //
      return (
        <>
          <LargeContainerWithCenter ref={boundingRef}
            x={loc.x}
            y={loc.y}
            z={loc.z}
          >
            <Box ref={elementRef} />
          </LargeContainerWithCenter>
          <button onClick={randomPoint}>Random Point</button>
        </>
      );
    }}</Example>
  </Story>
</Preview>

### Zoom To
This example shows how to zoom to a specific scale value without changing
the panned position. Try panning the element manually to see this in action.

<Preview>
  <Story name="Zoom To Example">
    <Example>{ () => {
      const [pz] = React.useState(() => new PanZ());
      const elementRef = React.useRef();
      const boundingRef = React.useRef();
      //
      const scales = [0.5, 1, 2, 2.5, 3.2, 4];
      const randomize = useRandomIndex(scales);
      const randomZoom = React.useCallback(() => {
        if (elementRef.current) {
          pz.zoomTo(scales[randomize()]);
        }
      });
      //
      React.useEffect(() => {
        if (elementRef.current && boundingRef.current) {
          pz.init(elementRef.current, {boundingElement: boundingRef.current, initialFit: 'center'});
          return () => pz.destroy();
        }
      }, []);
      //
      return (
        <>
          <LargeContainer ref={boundingRef}>
            <Box ref={elementRef} />
          </LargeContainer>
          <button onClick={randomZoom}>Random Zoom</button>
        </>
      );
    }}</Example>
  </Story>
</Preview>

### Pan To
This example shows how to pan to a specific point on the element without changing
the zoom level. Try changing the zoom level manually to see this in action.

<Preview>
  <Story name="Pan To Example">
    <Example>{ () => {
      const [pz] = React.useState(() => new PanZ());
      const [loc, setLoc] = React.useState({x: 0.5, y: 0.5});
      const elementRef = React.useRef();
      const boundingRef = React.useRef();
      //
      const randomPoint = React.useCallback(() => {
        if (elementRef.current) {
          const x = Math.random();
          const y = Math.random();
          setLoc({x, y});
          pz.panTo(x, y);
        }
      });
      //
      React.useEffect(() => {
        if (elementRef.current && boundingRef.current) {
          pz.init(elementRef.current, {boundingElement: boundingRef.current, initialFit: 'center'});
          return () => pz.destroy();
        }
      }, []);
      //
      return (
        <>
          <LargeContainerWithCenter ref={boundingRef}
            x={loc.x}
            y={loc.y}
          >
            <Box ref={elementRef} />
          </LargeContainerWithCenter>
          <button onClick={randomPoint}>Random Point</button>
        </>
      );
    }}</Example>
  </Story>
</Preview>


### Disable Pan or Zoom Example
This example shows how to disable panning or zooming individually.

<Preview>
  <Story name="Disable Pan or Zoom">
    <Example>{ () => {
      const [pz] = React.useState(() => new PanZ());
      const elementRef = React.useRef();
      const boundingRef = React.useRef();
      //
      const [panEnabled, setPanEnabled] = React.useState(true);
      const [zoomEnabled, setZoomEnabled] = React.useState(true);
      const onDisablePan  = () => {
        if (panEnabled) pz.disablePan();
        else pz.enablePan();
        setPanEnabled(!panEnabled);
      }
      const onDisableZoom = () => {
        if (zoomEnabled) pz.disableZoom();
        else pz.enableZoom();
        setZoomEnabled(!zoomEnabled);
      }
      //
      React.useEffect(() => {
        if (elementRef.current && boundingRef.current) {
          pz.init(elementRef.current, {boundingElement: boundingRef.current});
          return () => pz.destroy();
        }
      }, []);
      //
      return (
        <>
          <LargeContainer ref={boundingRef}>
            <Box ref={elementRef} />
          </LargeContainer>
          <button onClick={onDisablePan} >{panEnabled  ? 'Disable' : 'Enable'} Pan</button>
          <button onClick={onDisableZoom}>{zoomEnabled ? 'Disable' : 'Enable'} Zoom</button>
        </>
      );
    }}</Example>
  </Story>
</Preview>


### Events Example
This example shows a log of start/change/end events.

<Preview>
  <Story name="Events Example">
    <Example>{ () => {
      const [pz] = React.useState(() => new PanZ());
      const [events, setEvents] = React.useState([]);
      const addEvent = (name, e) =>
        setEvents(curr => curr.concat([{...e, name}]) );
      const resetEvents = (name, e) =>
        addEvent(name, e);
        //setEvents([{...e, name}]);
      //
      const elementRef = React.useRef();
      const boundingRef = React.useRef();
      //
      React.useEffect(() => {
        if (elementRef.current && boundingRef.current) {
          pz.init(elementRef.current, {boundingElement: boundingRef.current});
          pz.on('start',  e => resetEvents('start', e));
          pz.on('update', e => addEvent('change', e));
          pz.on('end',    e => addEvent('end', e));
          return () => pz.destroy();
        }
      }, []);
      //
      const [log] = React.useState(() => console.log);
      React.useEffect(() => {
        console.log = (...args) => {
          addEvent('log', {message: args.join(' ')});
        }
        //
        return () => {
          console.log = log;
        }
      }, []);
      //
      return (
        <>
          <LargeContainer ref={boundingRef}>
            <Box ref={elementRef} />
          </LargeContainer>
          <div
            style={{
              overflow: 'auto',
              height: '300px',
            }}
            >{ events.reduce((acc, curr, i) => {
              if (i === 0) acc.push({...curr, count: 1});
              else {
                const last = acc[acc.length - 1];
                //if (last.name !== curr.name) acc.push({...curr, count: 1});
                //else last.count += 1;
                acc.push({...curr, count: 1});
              }
              return acc;
            }, [])
            .map((e, i) =>
            <div key={i}>
              { e.name }&nbsp;
              { e.count > 1 ? `(${e.count})` : '' }&nbsp;
              { e.message ? e.message : ''}
            </div>
          )}</div>
          <div><button onClick={() => setEvents([])}>Clear</button></div>
        </>
      );
    }}</Example>
  </Story>
</Preview>

### Image
### SVG
### object-fit
### object-position
