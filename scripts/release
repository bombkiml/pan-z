#!/usr/bin/env sh

if output=$(git status --porcelain) && [ -z "$output" ]; then
  echo 'Checking out the master branch...'
  git checkout master
  git pull
  echo 'Validating project...'
  yarn validate
  yarn config set version-tag-prefix "release/"
  yarn config set version-git-message "[release][ci skip] prepare release/%s"
  yarn version
  version=$(node -e "console.log(require('./package.json').version)")
  echo 'Pushing release tag...'
  git push origin master
  git push origin "release/$version"
  echo 'Publishing to NPM...'
  npm publish --access public
  echo 'Deploying Storybook...'
  yarn deploy-storybook
else
  echo 'uncommitted files. Please commit all files first.'
  exit 1
fi
